<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="UTF-8">
  <title>NODE XYZ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <link rel="stylesheet" href="/assets/css/normalize.css">
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/assets/css/theme.css">
  <link rel="stylesheet" href="/assets/css/syntax.css">
  <!-- <link rel="stylesheet" href="/assets/css/main.css"> -->
  <link rel="stylesheet" href="/assets/css/stylish.css">

  <script
    src="https://code.jquery.com/jquery-3.1.1.min.js"
    integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
    crossorigin="anonymous"></script>

</head>

<body>

<style media="screen">
body {
  background-color: var(--light-color);
  color: var(--dark-color)
}
</style>
<style media="screen">
/* Nav */
#mainNav {
  color: var(--light-color) !important;
}

</style>

<nav class="navbar navbar-inverse" style="margin:0" id="mainNav">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand spacing" href="/">NODE XYZ</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Repositories <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li class="padding"> CORE REPOSITORIES </li>
            <li><a href="https://github.com/node-xyz/xyz-core" class="spacing">xyz.core</a></li>
            <li><a href="https://github.com/node-xyz/xyz-cli" class="spacing">xyz.cli</a></li>
            <li role="separator" class="divider"></li>
            <li class="padding"> ADDITIONAL </li>
            <li><a href="https://github.com/node-xyz/xyz.monitor.basic.bootstrap" class="spacing">xyz.monitor</a></li>
            <li><a href="https://github.com/node-xyz/xyz.ping.swim.bootstrap" class="spacing">xyz.ping.swim</a></li>
            <li><a href="https://github.com/node-xyz/xyz.ping.stochastic.bootstrap" class="spacing">xyz.ping.stochastic</a></li>
          </ul>
        </li>
      </ul>

      <ul class="nav navbar-nav navbar-left">
        <!-- <li><a href="#">Link</a></li> -->
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"> Documentations <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li class="padding"> READING </li>
            <li><a href="/documentations/getting-started">Getting Started</a></li>
            <li><a href="/documentations/advance">Advance Topics</a></li>
            <li><a href="/apidoc">API DOC</a></li>
            <li role="separator" class="divider"></li>
            <li class="padding"> EXAMPLES </li>
            <li class="spacing"><a href="https://github.com/node-xyz/xyz.example.getting.started">xyz.getting.started</a></li>
            <li class="spacing"><a href="https://github.com/node-xyz/xyz.example.logger.bootstrap">xyz.logger.bootstrap</a></li>
            <li class="spacing"><a href="https://github.com/node-xyz/xyz.example.auth.basic.receive">xyz.auth.basic.receive</a></li>
            <li class="spacing"><a href="https://github.com/node-xyz/xyz.example.auth.basic.send">xyz.auth.basic.send</a></li>
          </ul>
        </li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

<section class="container">

  <ol class="breadcrumb" style="margin: 10px; color: white;">
    <li><a class='spacing' href="/">Node XYZ </a></li>
    
    
    
    
    
    
    
    

    
      

    
      
      
      <li >
        <a style="color: inherit" href="/documentations/">documentation</a>
      </li>
      
      

    
      

    
      

    
      

    
      

    
      

    
      

    
      
      
    
    
    
    

    
      

    
      

    
      
      
      <li >
        <a style="color: inherit" href="/documentations/advance/">advance</a>
      </li>
      
      

    
      

    
      

    
      

    
      

    
      

    
      
      
    
    
    
    

    
      

    
      

    
      

    
      

    
      
      
      <li class="active">
        <a style="color: inherit" href="/documentations/advance/events/">events</a>
      </li>
      
      

    
      

    
      

    
      

    
      
      
    </ol>

    <hr>


    <h1 id="events">Events</h1>

<p>Due to the fact that xyz provides middleware handlers for most of the tasks and requests, most of the customized functionality can be implemented using them. Though, some events can also become very handy.</p>

<p>With the current release, xyz-core only emits events from the <code class="highlighter-rouge">ServiceRepository</code> layer. This means that you can listen to them like:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>aMicroServ = new XYZ({...})

aMicroServ.serviceRepository.on('event', ()=&gt;{})
</code></pre>
</div>

<p>The current emitted events are as follows:</p>

<ul>
  <li><code class="highlighter-rouge">'message:receive'</code>: emitted whenever a request (analogous to <code class="highlighter-rouge">.call()</code> from another service) is received. Parameters: an object with keys:
    <ul>
      <li>body: payload received with the request</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">'message:send'</code>: emitted whenever a request (analogous to <code class="highlighter-rouge">.call()</code>) is being sent. Parameters: an object with keys:
    <ul>
      <li>opt: options passed to the <code class="highlighter-rouge">.call()</code></li>
    </ul>
  </li>
</ul>

<p>Note that these events are received whenever <strong><em>Service Repository</em></strong> is informed of these events. This means that the Transport layer’s middlewares might drop a request due to any reason and in these scenarios, the service repository will not be informed, hence these events will not be fired.</p>

<p>A good way to use these events is through bootstrap functions. As an example, assume that your application wants a specific logging behavior whenever a message is being received, for security reasons for example.</p>

<p>You could do something like:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">_topSecretMessageLogger</span> <span class="p">(</span><span class="nx">xyz</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">xyz</span><span class="p">.</span><span class="nx">serviceRepository</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'message:receive'</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">topSecretTunnel</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">'message received!'</span><span class="p">)</span>
    <span class="p">...</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">_topSecretMessageLogger</span></code></pre></figure>

<p>And in you main app</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">let</span> <span class="nx">aMicroServ</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XYZ</span><span class="p">({...})</span>
<span class="nx">aMicroServ</span><span class="p">.</span><span class="nx">bootstrap</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s1">'./_topSecretMessageLogger'</span><span class="p">))</span></code></pre></figure>

<h2 id="some-events-under-the-hood">Some events under the hood</h2>

<p>If you think that these two events are not enough, which is not hard to argue!, you can also consider listening to xyz’s internal events.</p>

<p>XYZ is made up of two underlying layer, Service layer and Transport Layer. These two layers communicate with each other using events, and since you have access to them using <code class="highlighter-rouge">xyz.serviceRepository.transport</code>, you can also listen to these events.</p>

<p>As an example, you might have noticed that one of the default middlewares in transportServer’s <code class="highlighter-rouge">call.receive.mw</code> is something named <strong><a href="https://github.com/node-xyz/xyz-core/blob/master/src/Transport/Middlewares/call/http.receive.event.js">_httpMessageEvent</a></strong>. The only thing that this middleware does is to emit an event on the transport layer so that the service Repository can listen to it and receive it.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">_transport</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span>
    <span class="nx">CONSTANTS</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">MESSAGE</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">userPayload</span><span class="p">:</span> <span class="nx">body</span><span class="p">.</span><span class="nx">userPayload</span><span class="p">,</span>
      <span class="na">serviceName</span><span class="p">:</span> <span class="nx">body</span><span class="p">.</span><span class="nx">service</span>
    <span class="p">},</span>
    <span class="nx">response</span><span class="p">)</span></code></pre></figure>

<p>If you want to listen to it, you can do something like:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">let</span> <span class="nx">aMicroServ</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XYZ</span><span class="p">({...})</span>
<span class="kd">let</span> <span class="nx">CONSTANTS</span>  <span class="o">=</span> <span class="nx">aMicroServ</span><span class="p">.</span><span class="nx">CONSTANTS</span>
<span class="c1">// more info on constant names of events:</span>
<span class="c1">// https://github.com/node-xyz/xyz-core/blob/master/src/Config/Constants.js</span>

<span class="c1">// will listen to messages emitted from a server on port 4000</span>
<span class="nx">aMicroServ</span><span class="p">.</span><span class="nx">serviceRepository</span><span class="p">.</span><span class="nx">transport</span><span class="p">.</span><span class="nx">servers</span><span class="p">[</span><span class="mi">4000</span><span class="p">].</span><span class="nx">on</span><span class="p">(</span><span class="nx">CONSTANTS</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">MESSAGE</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="p">...</span>
  <span class="p">})</span></code></pre></figure>

<h2 id="this-is-not-the-end">This is not the end!</h2>

<p>We also encourage all plugins and middlewares to use this design pattern efficiently, when required. This means that one bootstrap function might actually extent the number of event that the <code class="highlighter-rouge">serviceRepository</code> can emit and add an event to it. As an example, since each bootstrap function has access to <code class="highlighter-rouge">xyz</code>, it has access to <code class="highlighter-rouge">xyz.serviceRepository</code>, hence it can <code class="highlighter-rouge">xyz.serviceRepository.emit(...)</code> and your code listen to it like any other event.</p>



  </section>
  
<style media="screen">
  .site-footer{
    padding: 30px;
    color: var(--light-color);
    background-color: var(--very-dark);
  }
</style>
<footer class="site-footer">
  <span class="site-footer-owner">
    <a href="http://localhost:1999">NODE XYZ</a>
     is maintained by <a href="">Kian Peymani & Ajand </a></span>
  <small>
    <br>
    <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a></small>
</footer>

  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" charset="utf-8"></script>

</body>
</html>
